<?xml version="1.0"?>
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:o="http://www.onlineobjects.com/jsf"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:gui="http://www.in2isoft.dk/in2igui"
  xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:oc = "http://java.sun.com/jsf/composite/components"
>
  <ui:composition template="templates/plain.xhtml">

    <ui:define name="body">
      <o:box>
        <o:header styleClass="oo_space_bottom-2">#{msg.account}</o:header>
        <oc:segment title="#{msg.account}">
          <oc:property label="#{msg.username}:" styleClass="oo_space_bottom">#{accountSettingsView.username}</oc:property>
          <div class="oo_space_bottom">
            <oc:property label="#{msg.full_name}:">
              <gui:pages name="namePages">
                <gui:page>
                  <p>#{accountSettingsView.fullName}
                    <gui:button name="changeName" text="#{msg.change}" small="true" variant="light"/>
                  </p>
                </gui:page>
                <gui:page>
                  <gui:formula name="nameForm">
                    <gui:field label="#{msg.first_name}">
                      <gui:textInput key="first" value="#{accountSettingsView.firstName}"/>
                    </gui:field>
                    <gui:field label="#{msg.middle_name}">
                      <gui:textInput key="middle" value="#{accountSettingsView.middleName}"/>
                    </gui:field>
                    <gui:field label="#{msg.last_name}">
                      <gui:textInput key="last" value="#{accountSettingsView.lastName}"/>
                    </gui:field>
                    <gui:buttons>
                      <gui:button text="#{msg.cancel}" variant="light" name="cancelChangeName"/>
                      <gui:button text="#{msg.change}" submit="true" variant="light" highlighted="true"/>
                    </gui:buttons>
                  </gui:formula>
                </gui:page>
              </gui:pages>
            </oc:property>
          </div>
          <div class="oo_space_bottom">
            <oc:property label="#{msg.primary_email}:">
              <gui:pages name="emailPages">
                <gui:page>
                  <p><o:out value="#{accountSettingsView.primaryEmail}" emptyText="None"/>${' '}
                  <gui:button name="changeEmail" text="#{msg.change}" small="true" variant="light" testName="changeMailButton"/></p>
                  <oc:text small="true">
                  <p>(#{msg.confirmed}: #{accountSettingsView.emailConfirmationDate})</p>
                  </oc:text>
                  <c:if test="#{!accountSettingsView.emailConfirmed}">
                    <div class="oo_space_top">
                    <gui:button name="confirmEmail" text="#{msg.send_email_confirm}" variant="light"/>
                    </div>
                  </c:if>
                </gui:page>
                <gui:page>
                  <oc:text small="true" styleClass="oo_space_bottom">
                    <p>Changing your e-mail requires you to validate that you have access to read messages sent to the new e-mail</p>
                  </oc:text>
                  <gui:formula name="mailForm">
                    <gui:field label="#{msg.primary_email}">
                      <gui:textInput key="mail" value="#{accountSettingsView.primaryEmail}" testName="changeMailInput"/>
                    </gui:field>
                    <gui:buttons>
                      <gui:button text="#{msg.cancel}" variant="light" name="cancelChangeEmail"/>
                      <gui:button text="#{msg.change}" submit="true" variant="light" highlighted="true" testName="changeMailSubmit"/>
                    </gui:buttons>
                  </gui:formula>
                </gui:page>
              </gui:pages>
            </oc:property>
          </div>
        </oc:segment>

        <oc:segment title="Privacy">
          <p>
            <o:link href="/${accountSettingsView.language}/agreements">#{msg.agreements_title}</o:link>
            <c:if test="${accountSettingsView.agreementAcceptanceTime != null}"> - ${o:formatDate(accountSettingsView.agreementAcceptanceTime, 'short')}</c:if>
            <c:if test="${!accountSettingsView.hasAcceptedTerms}"> - #{msg.agreements_todo}</c:if>
          </p>
        </oc:segment>

        <oc:segment title="Security">
          <gui:pages name="passwordPages">
            <gui:page>
              <gui:button name="changePassword" text="#{msg.change_password}" variant="light"></gui:button>
            </gui:page>
            <gui:page>
              <gui:formula name="passwordForm">
                <gui:field label="#{msg.current_password}">
                  <gui:textInput key="currentPassword" secret="true"/>
                </gui:field>
                <gui:field label="#{msg.new_password}">
                  <gui:textInput key="newPassword" secret="true"/>
                </gui:field>
                <gui:buttons>
                  <gui:button text="#{msg.cancel}" name="cancelPassword" variant="light"/>
                  <gui:button text="#{msg.change_password}" submit="true" variant="light" highlighted="true"/>
                </gui:buttons>
              </gui:formula>
            </gui:page>
          </gui:pages>
        </oc:segment>
        <oc:segment title="Privacy">
          <gui:button text="Delete account..." variant="light" passive="true" href="/${accountSettingsView.language}/delete/"/>
        </oc:segment>
      </o:box>

      <o:dependency src="/WEB-INF/apps/account/web/js/account.js"/>
    </ui:define>

  </ui:composition>

</html>